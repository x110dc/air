#compdef air

_air() { 
    local curcontext="$curcontext" state line
    typeset -A opt_args

    _arguments -C \
        ':command:->command' \
        '*::options:->options'

    case $state in
        (command)
            local -a subcommands
            subcommands=(
                'refresh:refresh a ticket'
                'start_work:start a ticket'
                'create_bug:create a bug'
            )
            _describe -t commands 'air' subcommands
        ;;
        (options)
            case $line[1] in
                (refresh)
#                    _arguments  ':ticket:__tickets'
                    _arguments  "(-t --ticket)"{-t,--ticket}"[ticket number]":thing:__tickets \
                    && ret=0
                ;;
            esac
    esac
}

__tickets ()
{
    _wanted application expl 'command' compadd $(command /Users/danielc/Git/mine/air/air ticket_completion 2> /dev/null)
}

_air "$@"
